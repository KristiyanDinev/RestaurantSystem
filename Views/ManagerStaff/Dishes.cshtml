@using RestaurantSystem.Enums
@using RestaurantSystem.Models.DatabaseModels
@using RestaurantSystem.Models.View.Messages
@model RestaurantSystem.Models.View.Staff.Manager.ManagerDishViewModel;
@{
    ViewData["Title"] = "Manage Dishes - Savans Restaurant";
}


<head>
    @await Html.PartialAsync("_Header")
    <script src="~/assets/staff/manager/manager_dishes.js"></script>
</head>


<body>
    @await Html.PartialAsync("_StaffNavBar", Model.Staff)
    @await Html.PartialAsync("_RestaurantBar", Model.Staff.Restaurant)
    @await Html.PartialAsync("_ManagerNavBar")
    <h3 class="justify-content-center d-flex" style="margin-top:  2em;">Manage Dishes</h3>
    @await Html.PartialAsync("_Paging", Model.Page)


    <div class="mx-3">
        @await Html.PartialAsync("_SuccessMessage", new MessageViewModel
        {
            Key = "CreatedSuccessfully",
            Message = "Successfully Created Dish!"
        })

        @await Html.PartialAsync("_SuccessMessage", new MessageViewModel
        {
            Key = "UpdatedSuccessfully",
            Message = "Successfully Updated Dish!"
        })

        @await Html.PartialAsync("_SuccessMessage", new MessageViewModel
        {
            Key = "DeletedSuccessfully",
            Message = "Successfully Deleted Dish!"
        })
    </div>

    <!-- Create Dish Button -->
<div class="w-100 text-center">
  <button class="btn btn-success m-3" onclick="toggleCreateDish()" type="button">
    <i class="bi bi-plus-circle me-2"></i>Create Dish
  </button>
</div>

<!-- Dish Creation Form -->
<div id="create_dish" class="container mb-4" style="display: none;">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6 p-4 border rounded-3 shadow-sm">
      <h4 class="text-center mb-4 text-success">New Dish Details</h4>

      <!-- Dish Name -->
      <div class="form-floating mb-3">
        <input id="dish_name" type="text" class="form-control" placeholder="Dish Name">
        <label for="dish_name"><i class="bi bi-tag"></i> Dish Name</label>
      </div>

      <!-- Dish Type -->
      <div class="form-floating mb-3">
        <select id="dish_type" class="form-select" required>
          <option value="@DishTypeEnum.salads.ToString()">Salads</option>
          <option value="@DishTypeEnum.soups.ToString()">Soups</option>
          <option value="@DishTypeEnum.appetizers.ToString()">Appetizers</option>
          <option value="@DishTypeEnum.dishes.ToString()">Dishes</option>
          <option value="@DishTypeEnum.desserts.ToString()">Desserts</option>
          <option value="@DishTypeEnum.drinks.ToString()">Drinks</option>
        </select>
        <label for="dish_type"><i class="bi bi-fork-knife"></i> Dish Type</label>
      </div>

      <!-- Dish Price -->
      <div class="form-floating mb-3">
        <input id="dish_price" type="number" class="form-control" min="0.1" max="9999999999" placeholder="Price">
        <label for="dish_price"><i class="bi bi-cash-coin"></i> Dish Price</label>
      </div>

      <!-- Ingredients -->
      <div class="form-floating mb-3">
        <input id="dish_ingredients" type="text" class="form-control" placeholder="Ingredients">
        <label for="dish_ingredients"><i class="bi bi-list-ul"></i> Ingredients</label>
      </div>

      <!-- Average Time to Cook -->
      <div class="form-floating mb-3">
        <input id="dish_attc" type="text" class="form-control" placeholder="Average Time">
        <label for="dish_attc"><i class="bi bi-clock"></i>Average Time to Cook (e.g. 1 - 2 minutes)</label>
      </div>

      <!-- Grams -->
      <div class="form-floating mb-3">
        <input id="dish_grams" type="number" class="form-control" min="1" max="999999" placeholder="Grams">
        <label for="dish_grams"><i class="bi bi-speedometer2"></i>Weight in Grams</label>
      </div>

      <!-- Availability -->
      <div class="form-check form-switch mb-3">
        <input id="dish_isavailable" type="checkbox" class="form-check-input">
        <label class="form-check-label" for="dish_isavailable">Available?</label>
      </div>

      <!-- Image Upload -->
      <div class="mb-3">
        <label for="dish_image" class="form-label">Dish Image</label>
        <input type="file" class="form-control" id="dish_image" accept="image/*">
        <div class="mt-2">
          <img id="preview" src="#" alt="Dish Image Preview" class="img-thumbnail d-none" width="150">
        </div>
        <button type="button" class="btn btn-outline-danger btn-sm mt-2" onclick="removeImage(null)">
          <i class="bi bi-trash"></i> Remove Image
        </button>
      </div>

      <!-- Submit -->
      <div class="text-center">
        <button type="button" class="btn btn-success px-4" onclick="createDish()">Submit</button>
      </div>
    </div>
  </div>
</div>

    <div class="table-responsive d-flex justify-content-center">
        <table class="dedish ptable mx-5 table table-bordered table-hover align-middle text-center ">
            <thead class="table-success">
                <tr>
                    <th>ID</th>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Ingredients</th>
                    <th>Grams</th>
                    <th>Type</th>
                    <th>Average Time To Cook</th>
                    <th>Is Available</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>

                @foreach (DishModel dish in Model.Dishes)
                {
                    <tr class="page-row">
                        <td>@dish.Id</td>
                        <td style="display: flex; justify-content: center; align-items: center;flex-direction: column;height: 100%;">
                            @if (!string.IsNullOrEmpty(dish.Image))
                            {
                                    <img src="@dish.Image" alt="Dish Image" width="80px" height="80px" class="mt-2 rounded img-thumbnail smi" />

                            } else {
                                    <div class="bg-warning bg-opacity-25 rounded d-flex align-items-center justify-content-center border border-warning" style="width: 80px; height: 80px;">
                                        <i class="bi bi-image text-warning fs-3"></i>
                                    </div>
                            }
                            <div id="image,@dish.Id" style="display:none;">
                                <input type="file" accept="image/*" id="inputimage,@dish.Id">
                                <button type="button" class="btn btn-danger rounded m-2" onclick="removeImage('@dish.Id')">Remove Image</button>
                                <img id="preview,@dish.Id" class="mt-2 rounded smi img-thumbnail" />
                                <div class="d-flex justify-content-center"><label for="deleteimage,@dish.Id">Delete Image?</label>
                                <input type="checkbox" id="deleteimage,@dish.Id"></div>
                                <script>
                                    registerPreview('@dish.Id')
                                </script>
                            </div>
                        </td>
                        <td>
                            <p>@dish.Name</p>
                            <input id="name,@dish.Id"
                                   type="text"
                                   style="display:none;"
                                   class="input-group form-control border border-warning rounded"
                                   placeholder="Dish Name" value="@dish.Name"
                                   required>
                        </td>
                        <td>
                            <p>@dish.Price lv.</p>
                            <input id="price,@dish.Id"
                                   type="number"
                                   style="display:none;"
                                   min="0.1" max="9999999999"
                                   class="input-group form-control  border border-warning rounded"
                                   placeholder="Dish Price lv." value="@dish.Price"
                                   required>
                        </td>
                        <td>
                            <p>@dish.Ingredients</p>
                            <input id="ingredients,@dish.Id"
                                   type="text"
                                   style="display:none;"
                                   class="input-group form-control border border-warning rounded"
                                   placeholder="Dish Ingredients" value="@dish.Ingredients"
                                   required>
                        </td>
                        <td>
                            <p>@dish.Grams</p>
                            <input id="grams,@dish.Id" type="number"
                                   class="input-group form-control border border-warning rounded"
                                   min="1" max="999999"
                                   style="display:none;"
                                   placeholder="Dish Grams" value="@dish.Grams" required>
                        </td>
                        <td>
                            <p>@dish.Type_Of_Dish.ToString()</p>
                            <select id="type,@dish.Id"
                                    style="display:none;"
                                    class="input-group form-control border border-warning rounded" required>
                                @if (dish.Type_Of_Dish.Equals(DishTypeEnum.salads))
                                {
                                    <option value="@DishTypeEnum.salads.ToString()" 
                                        selected>@DishTypeEnum.salads.ToString()</option>
                                } else
                                {
                                    <option value="@DishTypeEnum.salads.ToString()"
                                            >@DishTypeEnum.salads.ToString()</option>
                                }

                                @if (dish.Type_Of_Dish.Equals(DishTypeEnum.soups))
                                {
                                    <option value="@DishTypeEnum.soups.ToString()"
                                            selected>@DishTypeEnum.soups.ToString()</option>
                                }
                                else
                                {
                                    <option value="@DishTypeEnum.soups.ToString()"
                                        >@DishTypeEnum.soups.ToString()</option>
                                }

                                @if (dish.Type_Of_Dish.Equals(DishTypeEnum.appetizers))
                                {
                                    <option value="@DishTypeEnum.appetizers.ToString()"
                                            selected>@DishTypeEnum.appetizers.ToString()</option>
                                }
                                else
                                {
                                    <option value="@DishTypeEnum.appetizers.ToString()"
                                        >@DishTypeEnum.appetizers.ToString()</option>
                                }

                                @if (dish.Type_Of_Dish.Equals(DishTypeEnum.dishes))
                                {
                                    <option value="@DishTypeEnum.dishes.ToString()"
                                            selected>@DishTypeEnum.dishes.ToString()</option>
                                }
                                else
                                {
                                    <option value="@DishTypeEnum.dishes.ToString()"
                                        >@DishTypeEnum.dishes.ToString()</option>
                                }

                                @if (dish.Type_Of_Dish.Equals(DishTypeEnum.desserts))
                                {
                                    <option value="@DishTypeEnum.desserts.ToString()"
                                            selected>@DishTypeEnum.desserts.ToString()</option>
                                }
                                else
                                {
                                    <option value="@DishTypeEnum.desserts.ToString()">@DishTypeEnum.desserts.ToString()</option>
                                }

                                @if (dish.Type_Of_Dish.Equals(DishTypeEnum.drinks))
                                {
                                    <option value="@DishTypeEnum.drinks.ToString()"
                                    selected>@DishTypeEnum.drinks.ToString()</option>
                                }
                                else
                                {
                                    <option value="@DishTypeEnum.drinks.ToString()">@DishTypeEnum.drinks.ToString()</option>
                                }
                            </select>
                        </td>
                        <td>
                            <p>@dish.AverageTimeToCook</p>
                            <input id="attc,@dish.Id" type="text"
                                   class="input-group form-control"
                                   style="display:none;"
                                   placeholder="Dish Average Time To Cook: 1 - 2 minutes."
                                   value="@dish.AverageTimeToCook"
                                   required>
                        </td>
                        <td>
                            @if (dish.IsAvailable)
                            {
                                <i class="bi bi-check-lg"></i>
                                <input id="isavailable,@dish.Id" type="checkbox"
                                       style="display:none;"
                                       class="input-group"
                                       checked required>
                            }
                            else
                            {
                                <i class="bi bi-ban"></i>
                                <input id="isavailable,@dish.Id" type="checkbox"
                                       class="input-group"
                                       style="display:none;"
                                       required>
                            }
                        </td>
                        <td>
                            <div>
                                <button id="submit,@dish.Id" type="button"
                                        class="btn btn-primary m-2"
                                        onclick="editDish('@dish.Id')"
                                        style="display:none;">
                                    Submit Edited Dish
                                </button>
                                <button type="button"
                                        class="btn btn-primary m-2"
                                        onclick="toggleEditDish('@dish.Id')">
                                    Edit
                                </button>
                                <button type="button"
                                        class="btn btn-danger m-2"
                                        onclick="deleteDish('@dish.Id')">
                                    Delete Dish
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <script>
        document.getElementById("dish_image").onchange = (e) => {
            readURL(e.target, 'preview');
        };
    </script>

    @await Html.PartialAsync("_Footer")
</body>
